# 画像アップローダーアプリケーション仕様書

## 概要
シンプルな画像アップローダーアプリケーションを開発する。ユーザーは画像3. **PUT /edit_comment/<filename>**
   - 指定された画像のコメントを編集。
   - リクエスト: JSON (comment)
   - レスポンス: 成功/失敗メッセージ

4. **POST /generate**アップロードし、コメントを追加できる。また、AI（DALL-E）と連携し、画像とコメントをプロンプトとして新しい画像を生成することができる。

## 機能要件
1. **画像アップロード機能**
   - ユーザーは画像ファイルをアップロードできる。
   - サポートする画像形式: JPEG, PNG, GIF。
   - アップロードされた画像はサーバーに保存される。
   - アップロード成功時に確認メッセージを表示。
   - ファイルサイズ制限: 16MB

2. **コメント追加機能**
   - 画像アップロード時にコメントを入力できる。
   - コメントはテキストフィールドで入力。
   - コメントは画像と関連付けて保存。
   - **コメント編集機能**: アップロード後にコメントを編集可能。

3. **コメント編集機能**
   - 各画像にコメント編集ボタンを表示。
   - 編集ボタンをクリックするとコメントが入力フィールドに変わる。
   - 保存ボタンで変更を保存、キャンセルボタンで中止。
   - 編集結果は即座に反映。
   - アップロードされた画像とコメントをプロンプトとしてOpenRouterを介してGoogle Gemini 2.5 Flash Image (Nano Banana) に送信
   - AIが画像を分析し、創造的な新しい画像を生成
   - 生成された画像を保存して表示
   - OpenRouter APIを使用（APIキーが必要）

4. **画像表示機能**
   - アップロードされた画像を一覧表示。
   - 各画像にコメントを表示。
   - AI生成画像を表示。

5. **画像削除機能**
   - 各画像に削除ボタンを表示。
   - 削除確認ダイアログを表示。
   - 削除時に画像ファイルとデータベースエントリを削除。

6. **データベースリセット機能**
   - データベースとアップロードファイルをリセット。
   - リセット確認ダイアログを表示。
   - すべてのデータを削除して初期状態に戻す。

## 非機能要件
- **パフォーマンス**: 画像アップロードは5秒以内に完了。
- **セキュリティ**: アップロードされた画像は適切に検証（ファイルタイプ、サイズ制限）。
- **ユーザビリティ**: シンプルで直感的なUI、レスポンシブデザイン。
- **拡張性**: モジュール化された設計で将来の機能追加を容易に。
- **互換性**: 主要なWebブラウザで動作。

## システムアーキテクチャ
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla JS)。
- **バックエンド**: Python 3.13.7 + Flask 2.3.3。
- **データベース**: SQLite 3。
- **AI統合**: OpenRouter API (Google Gemini 2.5 Flash Image (Nano Banana))。
- **ファイルストレージ**: ローカルファイルシステム。
- **環境管理**: mise (Pythonバージョン管理)。

## API仕様
1. **POST /upload**
   - 画像とコメントをアップロード。
   - リクエスト: multipart/form-data (image, comment)。
   - レスポンス: 成功/失敗メッセージ。

2. **POST /generate**
   - 画像とコメントをプロンプトとしてOpenRouterを介してGoogle Gemini 2.5 Flash Image (Nano Banana)に送信
   - リクエスト: JSON (filename, comment)
   - レスポンス: 生成された画像のファイル名

3. **GET /images**
   - アップロードされた画像一覧を取得
   - レスポンス: JSON配列 (filename, comment, generated_image_filename)

4. **DELETE /delete/<filename>**
   - 指定された画像を削除。
   - リクエスト: DELETEメソッド。
   - レスポンス: 成功/失敗メッセージ。

5. **POST /reset**
   - データベースとファイルをリセット。
   - リクエスト: POSTメソッド。
   - レスポンス: 成功/失敗メッセージ。

## UI/UX仕様
- **メイン画面**: 画像アップロードフォーム、画像一覧、DBリセットボタン。
- **アップロードフォーム**: ファイル選択、コメント入力、アップロードボタン。
- **画像一覧**: サムネイル表示、コメント表示、**コメント編集ボタン**、AI生成ボタン、削除ボタン。
- **コメント編集**: 編集ボタンクリックで入力フィールドに切り替え、保存/キャンセルボタン表示。
- **AI生成画像**: 生成された画像を専用のセクションで表示。
- **レスポンシブデザイン**: デスクトップ、タブレット、モバイル対応。
- **モダンUI**: グラデーション背景、カードベースレイアウト、アニメーション効果。

## 技術スタック
- **バックエンド**: Python 3.13.7 + Flask 2.3.3
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **AI**: Google Gemini 2.5 Flash Image Preview (Free) via OpenRouter
- **データベース**: SQLite 3
- **HTTPクライアント**: requests==2.31.0
- **画像処理**: Pillow 10.4.0
- **環境管理**: mise
- **バージョン管理**: Git

## 開発プロセス
1. **仕様書作成** (完了) - 2025年9月2日
2. **プロジェクト構造作成** (完了) - Flask + SQLite + HTML/CSS/JS
3. **バックエンド開発** (完了) - API実装、データベース操作、AI統合
4. **フロントエンド開発** (完了) - モダンUI、レスポンシブデザイン
5. **AI統合** (完了) - OpenRouterを介してGoogle Gemini 2.5 Flash Image (Nano Banana)連携
6. **テストとデバッグ** (完了) - エラーハンドリング、URLエンコード修正
7. **ドキュメント作成** (完了) - README、仕様書更新

## リスクと考慮事項
- **OpenRouter APIの使用制限とコスト**: Google Gemini 2.5 Flash Image (Nano Banana)は無料プランですが、使用制限がある場合がある
- **画像ファイルのセキュリティ**: 悪意あるファイルのアップロード防止
- **プライバシー**: アップロードされた画像とコメントの扱い
- **AI生成画像の品質と適切性**: 生成される画像の内容確認
- **APIレスポンス時間**: OpenRouterのレスポンスに数秒～数十秒かかる場合がある
- **ストレージ容量**: アップロード画像と生成画像の累積によるディスク容量消費
- **データベースの破損**: SQLiteファイルのバックアップ推奨

## 環境情報
- **OS**: Linux
- **Python**: 3.13.7 (mise経由)
- **Webサーバー**: Flask 開発サーバー
- **データベース**: SQLite 3 (ファイルベース)
- **ブラウザ**: 主要ブラウザ対応
- **ネットワーク**: インターネット接続（OpenRouter APIアクセス用）

## デプロイメント考慮事項
- **本番環境**: Gunicorn + Nginx推奨
- **データベース**: 本番ではPostgreSQL検討
- **ファイルストレージ**: 本番ではクラウドストレージ（AWS S3等）検討
- **セキュリティ**: HTTPS対応、APIキー管理
- **監視**: ログ収集、エラートラッキング
