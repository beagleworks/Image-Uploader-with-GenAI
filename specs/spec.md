# 画像アップローダーアプリケーション仕様書

## 概要
シンプルな画像アップローダーアプリケーションを開発する。ユーザーは画像をアップロードし、コメントを追加できる。また、AI（DALL-E）と連携し、画像とコメントをプロンプトとして新しい画像を生成することができる。

## 機能要件
1. **画像アップロード機能**
   - ユーザーは画像ファイルをアップロードできる。
   - サポートする画像形式: JPEG, PNG, GIF。
   - アップロードされた画像はサーバーに保存される。
   - アップロード成功時に確認メッセージを表示。
   - ファイルサイズ制限: 16MB

2. **コメント追加機能**
   - 画像アップロード時にコメントを入力できる。
   - コメントはテキストフィールドで入力。
   - コメントは画像と関連付けて保存。

3. **AI生成機能**
   - アップロードされた画像とコメントをプロンプトとしてDALL-E 3に送信。
   - ボタンを押すとAIから画像レスポンスを取得。
   - 生成された画像を表示。
   - OpenAI APIを使用（APIキーが必要）。

4. **画像表示機能**
   - アップロードされた画像を一覧表示。
   - 各画像にコメントを表示。
   - AI生成画像を表示。

5. **画像削除機能**
   - 各画像に削除ボタンを表示。
   - 削除確認ダイアログを表示。
   - 削除時に画像ファイルとデータベースエントリを削除。

6. **データベースリセット機能**
   - データベースとアップロードファイルをリセット。
   - リセット確認ダイアログを表示。
   - すべてのデータを削除して初期状態に戻す。

## 非機能要件
- **パフォーマンス**: 画像アップロードは5秒以内に完了。
- **セキュリティ**: アップロードされた画像は適切に検証（ファイルタイプ、サイズ制限）。
- **ユーザビリティ**: シンプルで直感的なUI、レスポンシブデザイン。
- **拡張性**: モジュール化された設計で将来の機能追加を容易に。
- **互換性**: 主要なWebブラウザで動作。

## システムアーキテクチャ
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla JS)。
- **バックエンド**: Python 3.13.7 + Flask 2.3.3。
- **データベース**: SQLite 3。
- **AI統合**: OpenAI DALL-E 3 API。
- **ファイルストレージ**: ローカルファイルシステム。
- **環境管理**: mise (Pythonバージョン管理)。

## API仕様
1. **POST /upload**
   - 画像とコメントをアップロード。
   - リクエスト: multipart/form-data (image, comment)。
   - レスポンス: 成功/失敗メッセージ。

2. **POST /generate**
   - 画像とコメントをプロンプトとしてAIに送信。
   - リクエスト: JSON (image_path, comment)。
   - レスポンス: 生成された画像のURLまたはデータ。

3. **GET /images**
   - アップロードされた画像一覧を取得。
   - レスポンス: JSON配列 (filename, comment, ai_generated_image)。

4. **DELETE /delete/<filename>**
   - 指定された画像を削除。
   - リクエスト: DELETEメソッド。
   - レスポンス: 成功/失敗メッセージ。

5. **POST /reset**
   - データベースとファイルをリセット。
   - リクエスト: POSTメソッド。
   - レスポンス: 成功/失敗メッセージ。

## UI/UX仕様
- **メイン画面**: 画像アップロードフォーム、画像一覧、DBリセットボタン。
- **アップロードフォーム**: ファイル選択、コメント入力、アップロードボタン。
- **画像一覧**: サムネイル表示、コメント表示、AI生成ボタン、削除ボタン。
- **AI生成画像**: 生成された画像を専用のセクションで表示。
- **レスポンシブデザイン**: デスクトップ、タブレット、モバイル対応。
- **モダンUI**: グラデーション背景、カードベースレイアウト、アニメーション効果。

## 技術スタック
- **バックエンド**: Python 3.13.7 + Flask 2.3.3
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **AI**: OpenAI DALL-E 3 API (openai==1.3.0)
- **データベース**: SQLite 3
- **HTTPクライアント**: requests==2.31.0
- **画像処理**: なし（直接API使用）
- **環境管理**: mise
- **バージョン管理**: Git

## 開発プロセス
1. **仕様書作成** (完了) - 2025年9月2日
2. **プロジェクト構造作成** (完了) - Flask + SQLite + HTML/CSS/JS
3. **バックエンド開発** (完了) - API実装、データベース操作、AI統合
4. **フロントエンド開発** (完了) - モダンUI、レスポンシブデザイン
5. **AI統合** (完了) - DALL-E 3 API連携
6. **テストとデバッグ** (完了) - エラーハンドリング、URLエンコード修正
7. **ドキュメント作成** (完了) - README、仕様書更新

## リスクと考慮事項
- **OpenAI APIの使用制限とコスト**: 特に画像生成は高コスト（約$0.04/画像）
- **画像ファイルのセキュリティ**: 悪意あるファイルのアップロード防止
- **プライバシー**: アップロードされた画像とコメントの扱い
- **AI生成画像の品質と適切性**: 生成される画像の内容確認
- **画像生成の処理時間**: APIレスポンスに数秒～数十秒かかる場合がある
- **ストレージ容量**: アップロード画像の累積によるディスク容量消費
- **データベースの破損**: SQLiteファイルのバックアップ推奨

## 環境情報
- **OS**: Linux
- **Python**: 3.13.7 (mise経由)
- **Webサーバー**: Flask 開発サーバー
- **データベース**: SQLite 3 (ファイルベース)
- **ブラウザ**: 主要ブラウザ対応
- **ネットワーク**: インターネット接続（OpenAI APIアクセス用）

## デプロイメント考慮事項
- **本番環境**: Gunicorn + Nginx推奨
- **データベース**: 本番ではPostgreSQL検討
- **ファイルストレージ**: 本番ではクラウドストレージ（AWS S3等）検討
- **セキュリティ**: HTTPS対応、APIキー管理
- **監視**: ログ収集、エラートラッキング
